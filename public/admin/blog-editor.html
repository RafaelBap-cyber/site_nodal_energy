<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editor de Blog - Nodal Energy</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8fafc;
      color: #1e293b;
      line-height: 1.6;
    }
    
    .editor-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .editor-header {
      background: linear-gradient(135deg, #059669 0%, #0ea5e9 100%);
      color: white;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      text-align: center;
    }
    
    .editor-title {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .editor-subtitle {
      opacity: 0.9;
      font-size: 1.1rem;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    
    .form-label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #374151;
    }
    
    .form-input, .form-select, .form-textarea {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #059669;
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }
    
    .form-textarea {
      min-height: 200px;
      resize: vertical;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .content-editor {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .editor-toolbar {
      background: #f3f4f6;
      padding: 0.75rem;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .toolbar-btn {
      background: white;
      border: 1px solid #d1d5db;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }
    
    .toolbar-btn:hover {
      background: #f9fafb;
      border-color: #9ca3af;
    }
    
    .toolbar-btn.active {
      background: #059669;
      color: white;
      border-color: #059669;
    }
    
    .content-area {
      padding: 1rem;
      min-height: 400px;
      outline: none;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .content-area:empty::before {
      content: 'Digite o conteúdo do seu post aqui...';
      color: #9ca3af;
    }
    
    .actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }
    
    .btn {
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #059669 0%, #0ea5e9 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
    }
    
    .btn-secondary {
      background: #6b7280;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #4b5563;
    }
    
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    
    .btn-danger:hover {
      background: #dc2626;
    }
    
    .preview-container {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 2rem;
      margin-top: 2rem;
      display: none;
    }
    
    .preview-container.show {
      display: block;
    }
    
    .preview-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1f2937;
    }
    
    .preview-meta {
      background: #f3f4f6;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    .preview-content {
      line-height: 1.8;
      color: #374151;
    }
    
    .preview-content h1, .preview-content h2, .preview-content h3 {
      margin: 1.5rem 0 1rem 0;
      color: #1f2937;
    }
    
    .preview-content p {
      margin-bottom: 1rem;
    }
    
    .preview-content blockquote {
      border-left: 4px solid #059669;
      padding-left: 1rem;
      margin: 1.5rem 0;
      font-style: italic;
      color: #6b7280;
    }
    
    .preview-content code {
      background: #f3f4f6;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.875rem;
    }
    
    .preview-content pre {
      background: #1f2937;
      color: #f9fafb;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      margin: 1.5rem 0;
    }
    
    .preview-content pre code {
      background: none;
      color: inherit;
      padding: 0;
    }
    
    .status-message {
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      display: none;
    }
    
    .status-success {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #059669;
    }
    
    .status-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
    }
    
    .status-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #2563eb;
    }
    
    .posts-list {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 2rem;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .post-item {
      padding: 0.75rem;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    .post-item:hover {
      background-color: #f9fafb;
    }
    
    .post-item:last-child {
      border-bottom: none;
    }
    
    .post-title {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }
    
    .post-meta {
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .actions {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="editor-container">
    <div class="editor-header">
      <h1 class="editor-title">Editor de Blog - Nodal Energy</h1>
      <p class="editor-subtitle">Crie e edite posts para o seu site</p>
    </div>
    
    <div id="status-message" class="status-message"></div>
    
    <form id="blog-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="title" class="form-label">Título do Post *</label>
          <input type="text" id="title" name="title" class="form-input" required placeholder="Digite o título do post">
        </div>
        
        <div class="form-group">
          <label for="author" class="form-label">Autor *</label>
          <input type="text" id="author" name="author" class="form-input" required placeholder="Nome do autor">
        </div>
        
        <div class="form-group">
          <label for="category" class="form-label">Categoria *</label>
          <select id="category" name="category" class="form-select" required>
            <option value="">Selecione uma categoria</option>
            <option value="Energia Solar">Energia Solar</option>
            <option value="Energia Eólica">Energia Eólica</option>
            <option value="Eficiência Energética">Eficiência Energética</option>
            <option value="Sustentabilidade">Sustentabilidade</option>
            <option value="Tecnologia">Tecnologia</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="excerpt" class="form-label">Resumo *</label>
          <textarea id="excerpt" name="excerpt" class="form-textarea" required placeholder="Breve descrição do post"></textarea>
        </div>
        
        <div class="form-group full-width">
          <label for="content" class="form-label">Conteúdo *</label>
          <div class="content-editor">
            <div class="editor-toolbar">
              <button type="button" class="toolbar-btn" data-command="bold" title="Negrito (Ctrl+B)">
                <strong>B</strong>
              </button>
              <button type="button" class="toolbar-btn" data-command="italic" title="Itálico (Ctrl+I)">
                <em>I</em>
              </button>
              <button type="button" class="toolbar-btn" data-command="underline" title="Sublinhado (Ctrl+U)">
                <u>U</u>
              </button>
              <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Lista não ordenada">
                • Lista
              </button>
              <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Lista ordenada">
                1. Lista
              </button>
              <button type="button" class="toolbar-btn" data-command="createLink" title="Inserir link">
                🔗 Link
              </button>
              <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h1" title="Título 1">
                H1
              </button>
              <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Título 2">
                H2
              </button>
              <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h3" title="Título 3">
                H3
              </button>
              <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="blockquote" title="Citação">
                "Citação
              </button>
              <button type="button" class="toolbar-btn" data-command="insertCode" title="Código inline">
                &lt;/&gt;
              </button>
            </div>
            <div id="content" class="content-area" contenteditable="true"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="tags" class="form-label">Tags</label>
          <input type="text" id="tags" name="tags" class="form-input" placeholder="tag1, tag2, tag3">
        </div>
        
        <div class="form-group">
          <label for="coverImage" class="form-label">Imagem de Capa</label>
          <input type="file" id="coverImage" name="coverImage" class="form-input" accept="image/*">
        </div>
      </div>
      
      <div class="actions">
        <button type="button" class="btn btn-secondary" onclick="previewPost()">
          👁️ Visualizar
        </button>
        <button type="button" class="btn btn-primary" onclick="savePost()">
          💾 Salvar Post
        </button>
        <button type="button" class="btn btn-danger" onclick="clearForm()">
          🗑️ Limpar
        </button>
      </div>
    </form>
    
    <div id="preview-container" class="preview-container">
      <h2 class="preview-title" id="preview-title"></h2>
      <div class="preview-meta" id="preview-meta"></div>
      <div class="preview-content" id="preview-content"></div>
    </div>
    
    <!-- Lista de Posts Existentes -->
    <div class="posts-list">
      <h3 class="form-label mb-3">Posts Existentes</h3>
      <div id="existing-posts"></div>
    </div>
  </div>

  <script>
    let currentPost = null;
    
    // Inicializar editor
    document.addEventListener('DOMContentLoaded', function() {
      initializeEditor();
      loadExistingPosts();
    });
    
    function initializeEditor() {
      // Configurar toolbar
      document.querySelectorAll('.toolbar-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const command = this.dataset.command;
          const value = this.dataset.value;
          
          if (command === 'createLink') {
            const url = prompt('Digite a URL:');
            if (url) {
              document.execCommand(command, false, url);
            }
          } else if (command === 'insertCode') {
            document.execCommand('insertHTML', false, '<code>código</code>');
          } else {
            document.execCommand(command, false, value);
          }
          
          // Atualizar estado dos botões
          updateToolbarState();
        });
      });
      
      // Atalhos de teclado
      document.getElementById('content').addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'b':
              e.preventDefault();
              document.execCommand('bold', false);
              break;
            case 'i':
              e.preventDefault();
              document.execCommand('italic', false);
              break;
            case 'u':
              e.preventDefault();
              document.execCommand('underline', false);
              break;
          }
          updateToolbarState();
        }
      });
      
      // Auto-save
      setInterval(autoSave, 30000); // Salvar a cada 30 segundos
    }
    
    function updateToolbarState() {
      document.querySelectorAll('.toolbar-btn').forEach(btn => {
        const command = btn.dataset.command;
        if (command === 'formatBlock') {
          const value = btn.dataset.value;
          btn.classList.toggle('active', document.queryCommandValue('formatBlock') === value);
        } else {
          btn.classList.toggle('active', document.queryCommandState(command));
        }
      });
    }
    
    function previewPost() {
      const title = document.getElementById('title').value;
      const author = document.getElementById('author').value;
      const category = document.getElementById('category').value;
      const excerpt = document.getElementById('excerpt').value;
      const content = document.getElementById('content').innerHTML;
      const tags = document.getElementById('tags').value;
      
      if (!title || !author || !category || !excerpt || !content.trim()) {
        showStatus('Preencha todos os campos obrigatórios para visualizar', 'error');
        return;
      }
      
      document.getElementById('preview-title').textContent = title;
      document.getElementById('preview-meta').innerHTML = `
        <strong>Autor:</strong> ${author} | 
        <strong>Categoria:</strong> ${category} | 
        <strong>Data:</strong> ${new Date().toLocaleDateString('pt-BR')}
        ${tags ? ` | <strong>Tags:</strong> ${tags}` : ''}
      `;
      document.getElementById('preview-content').innerHTML = content;
      
      document.getElementById('preview-container').classList.add('show');
      document.getElementById('preview-container').scrollIntoView({ behavior: 'smooth' });
    }
    
    function savePost() {
      const formData = new FormData(document.getElementById('blog-form'));
      const content = document.getElementById('content').innerHTML;
      
      if (!formData.get('title') || !formData.get('author') || !formData.get('category') || 
          !formData.get('excerpt') || !content.trim()) {
        showStatus('Preencha todos os campos obrigatórios', 'error');
        return;
      }
      
      const post = {
        id: currentPost ? currentPost.id : Date.now().toString(),
        title: formData.get('title'),
        author: formData.get('author'),
        category: formData.get('category'),
        excerpt: formData.get('excerpt'),
        content: content,
        tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
        date: new Date().toISOString(),
        slug: generateSlug(formData.get('title')),
        coverImage: formData.get('coverImage') ? formData.get('coverImage').name : null,
        readTime: calculateReadTime(content)
      };
      
      // Salvar no localStorage
      savePostToStorage(post);
      
      // Salvar arquivo Markdown
      savePostToFile(post);
      
      showStatus('Post salvo com sucesso!', 'success');
      currentPost = post;
      
      // Atualizar lista de posts existentes
      loadExistingPosts();
      
      // Limpar formulário após salvar
      clearForm();
    }
    
    function savePostToStorage(post) {
      const posts = JSON.parse(localStorage.getItem('nodalEnergyPosts') || '[]');
      const existingIndex = posts.findIndex(p => p.id === post.id);
      
      if (existingIndex >= 0) {
        posts[existingIndex] = post;
      } else {
        posts.push(post);
      }
      
      localStorage.setItem('nodalEnergyPosts', JSON.stringify(posts));
    }
    
    function savePostToFile(post) {
      // Converter para Markdown
      const markdown = convertToMarkdown(post);
      
      // Criar blob e download
      const blob = new Blob([markdown], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${post.slug}.md`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    function convertToMarkdown(post) {
      let markdown = `---\n`;
      markdown += `title: "${post.title}"\n`;
      markdown += `author: "${post.author}"\n`;
      markdown += `date: "${post.date}"\n`;
      markdown += `category: "${post.category}"\n`;
      markdown += `excerpt: "${post.excerpt}"\n`;
      if (post.tags.length > 0) {
        markdown += `tags: [${post.tags.map(t => `"${t}"`).join(', ')}]\n`;
      }
      if (post.coverImage) {
        markdown += `coverImage: "${post.coverImage}"\n`;
      }
      markdown += `---\n\n`;
      markdown += `# ${post.title}\n\n`;
      markdown += `**Autor:** ${post.author} | **Data:** ${new Date(post.date).toLocaleDateString('pt-BR')} | **Categoria:** ${post.category}\n\n`;
      markdown += `${post.excerpt}\n\n`;
      markdown += `---\n\n`;
      
      // Converter HTML para Markdown simples
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = post.content;
      
      // Processar elementos HTML
      let content = tempDiv.innerHTML
        .replace(/<h1[^>]*>(.*?)<\/h1>/gi, '\n# $1\n')
        .replace(/<h2[^>]*>(.*?)<\/h2>/gi, '\n## $1\n')
        .replace(/<h3[^>]*>(.*?)<\/h3>/gi, '\n### $1\n')
        .replace(/<p[^>]*>(.*?)<\/p>/gi, '\n$1\n')
        .replace(/<br\s*\/?>/gi, '\n')
        .replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**')
        .replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*')
        .replace(/<u[^>]*>(.*?)<\/u>/gi, '__$1__')
        .replace(/<code[^>]*>(.*?)<\/code>/gi, '`$1`')
        .replace(/<blockquote[^>]*>(.*?)<\/blockquote>/gi, '\n> $1\n')
        .replace(/<ul[^>]*>(.*?)<\/ul>/gi, '\n$1\n')
        .replace(/<ol[^>]*>(.*?)<\/ol>/gi, '\n$1\n')
        .replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1')
        .replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)');
      
      markdown += content;
      
      return markdown;
    }
    
    function generateSlug(title) {
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .trim();
    }
    
    function calculateReadTime(content) {
      const wordsPerMinute = 200;
      const words = content.split(/\s+/).length;
      const minutes = Math.ceil(words / wordsPerMinute);
      return `${minutes} min`;
    }
    
    function loadExistingPosts() {
      const posts = JSON.parse(localStorage.getItem('nodalEnergyPosts') || '[]');
      const container = document.getElementById('existing-posts');
      
      if (posts.length === 0) {
        container.innerHTML = '<p class="text-gray-500">Nenhum post encontrado</p>';
        return;
      }
      
      container.innerHTML = posts.map(post => `
        <div class="post-item" onclick="loadPost('${post.id}')">
          <div class="post-title">${post.title}</div>
          <div class="post-meta">
            ${post.author} • ${post.category} • ${new Date(post.date).toLocaleDateString('pt-BR')}
          </div>
        </div>
      `).join('');
    }
    
    function loadPost(postId) {
      const posts = JSON.parse(localStorage.getItem('nodalEnergyPosts') || '[]');
      const post = posts.find(p => p.id === postId);
      
      if (post) {
        currentPost = post;
        document.getElementById('title').value = post.title;
        document.getElementById('author').value = post.author;
        document.getElementById('category').value = post.category;
        document.getElementById('excerpt').value = post.excerpt;
        document.getElementById('content').innerHTML = post.content;
        document.getElementById('tags').value = post.tags ? post.tags.join(', ') : '';
        
        showStatus(`Post "${post.title}" carregado para edição`, 'info');
        
        // Scroll para o topo do formulário
        document.getElementById('blog-form').scrollIntoView({ behavior: 'smooth' });
      }
    }
    
    function clearForm() {
      if (confirm('Tem certeza que deseja limpar o formulário?')) {
        document.getElementById('blog-form').reset();
        document.getElementById('content').innerHTML = '';
        document.getElementById('preview-container').classList.remove('show');
        currentPost = null;
        showStatus('Formulário limpo', 'info');
      }
    }
    
    function autoSave() {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').innerHTML;
      
      if (title && content.trim()) {
        const draft = {
          title,
          content,
          timestamp: Date.now()
        };
        localStorage.setItem('nodalEnergyDraft', JSON.stringify(draft));
      }
    }
    
    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status-message');
      statusDiv.textContent = message;
      statusDiv.className = `status-message status-${type}`;
      statusDiv.style.display = 'block';
      
      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 5000);
    }
  </script>
</body>
</html>

