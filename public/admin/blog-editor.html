<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editor de Blog - Nodal Energy</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8fafc;
      color: #1e293b;
      line-height: 1.6;
    }
    
    .editor-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .editor-header {
      background: linear-gradient(135deg, #052b18 0%, #0ea5e9 100%);
      color: white;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      text-align: center;
    }
    
    .editor-title {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .editor-subtitle {
      opacity: 0.9;
      font-size: 1.1rem;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    
    .form-label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #374151;
    }
    
    .form-input, .form-select, .form-textarea {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #052b18;
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }
    
    .form-textarea {
      min-height: 200px;
      resize: vertical;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .content-editor {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .editor-toolbar {
      background: #f3f4f6;
      padding: 0.75rem;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .toolbar-btn {
      background: white;
      border: 1px solid #d1d5db;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }
    
    .toolbar-btn:hover {
      background: #f9fafb;
      border-color: #9ca3af;
    }
    
    .toolbar-btn.active {
      background: #052b18;
      color: white;
      border-color: #052b18;
    }
    
    .toolbar-select {
      background: white;
      border: 1px solid #d1d5db;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 120px;
      height: 36px;
      font-size: 0.875rem;
    }
    
    .toolbar-select:hover {
      border-color: #9ca3af;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .toolbar-select:focus {
      outline: none;
      border-color: #052b18;
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }
    
    .toolbar-separator {
      width: 1px;
      height: 24px;
      background: #d1d5db;
      margin: 0 0.25rem;
    }
    
    .toolbar-info {
      display: flex;
      align-items: center;
      padding: 0 0.5rem;
    }
    
    .toolbar-tip {
      font-size: 12px;
      color: #6b7280;
      font-style: italic;
      white-space: nowrap;
    }
    
    .content-area {
      padding: 1rem;
      min-height: 400px;
      outline: none;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .content-area:empty::before {
      content: 'Digite o conte√∫do do seu post aqui...';
      color: #9ca3af;
    }
    
    /* Estilos para imagens no editor */
    .content-area img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 1rem 0;
      display: block;
    }
    
    .content-area img:hover {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
      transition: all 0.3s ease;
    }
    
    /* Estilos para imagens edit√°veis */
    .content-area .editable-image {
      cursor: pointer;
      position: relative;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    
    .content-area .editable-image:hover {
      border-color: #052b18;
      box-shadow: 0 6px 20px rgba(5, 150, 105, 0.2);
    }
    
    .content-area .editable-image::after {
      content: 'üñºÔ∏è Clique para editar';
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: #052b18;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      white-space: nowrap;
    }
    
    .content-area .editable-image:hover::after {
      opacity: 1;
    }
    
    .content-area .editable-image.image-edited {
      border-color: #f59e0b;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
    }
    
    .content-area .editable-image.image-edited::after {
      content: '‚úèÔ∏è Editada';
      background: #f59e0b;
    }
    
    /* Estilos para redimensionamento de imagens */
    .content-area .editable-image.resizing {
      position: relative;
      z-index: 998;
    }
    
    .resize-handles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
    
    .resize-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #052b18;
      border: 2px solid white;
      border-radius: 50%;
      pointer-events: all;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
    }
    
    .resize-handle:hover {
      background: #0a3d26;
      transform: scale(1.2);
    }
    
    .resize-instructions {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      background: #052b18;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    

    
    .actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }
    
    .btn {
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #052b18 0%, #0ea5e9 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
    }
    
    .btn-secondary {
      background: #6b7280;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #4b5563;
    }
    
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    
    .btn-danger:hover {
      background: #dc2626;
    }
    

    
    .status-message {
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      display: none;
    }
    
    .status-success {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #052b18;
    }
    
    .status-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
    }
    
    .status-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #2563eb;
    }
    
    .posts-list {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 2rem;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .post-item {
      padding: 0.75rem;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    .post-item:hover {
      background-color: #f9fafb;
    }
    
    .post-item:last-child {
      border-bottom: none;
    }
    
    .post-title {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }
    
    .post-meta {
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .actions {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="editor-container">
    <div class="editor-header">
      <h1 class="editor-title">Editor de Blog - Nodal Energy</h1>
      <p class="editor-subtitle">Crie e edite posts para o seu site</p>
    </div>
    
    <div id="status-message" class="status-message"></div>
    
    <form id="blog-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="title" class="form-label">T√≠tulo do Post *</label>
          <input type="text" id="title" name="title" class="form-input" required placeholder="Digite o t√≠tulo do post">
        </div>
        
        <div class="form-group">
          <label for="author" class="form-label">Autor *</label>
          <input type="text" id="author" name="author" class="form-input" required placeholder="Nome do autor">
        </div>
        
        <div class="form-group">
          <label for="category" class="form-label">Categoria *</label>
          <select id="category" name="category" class="form-select" required>
            <option value="">Selecione uma categoria</option>
            <option value="Energia Solar">Energia Solar</option>
            <option value="Energia E√≥lica">Energia E√≥lica</option>
            <option value="Efici√™ncia Energ√©tica">Efici√™ncia Energ√©tica</option>
            <option value="Sustentabilidade">Sustentabilidade</option>
            <option value="Tecnologia">Tecnologia</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="excerpt" class="form-label">Resumo *</label>
          <textarea id="excerpt" name="excerpt" class="form-textarea" required placeholder="Breve descri√ß√£o do post"></textarea>
        </div>
        
        <div class="form-group full-width">
          <label for="content" class="form-label">Conte√∫do *</label>
          <div class="content-editor">
            <div class="editor-toolbar">
              <button type="button" class="toolbar-btn" data-command="bold" title="Negrito (Ctrl+B)">
                <strong>B</strong>
              </button>
              <button type="button" class="toolbar-btn" data-command="italic" title="It√°lico (Ctrl+I)">
                <em>I</em>
              </button>
              <button type="button" class="toolbar-btn" data-command="underline" title="Sublinhado (Ctrl+U)">
                <u>U</u>
              </button>
              
              <div class="toolbar-separator"></div>
              
              <select class="toolbar-select" id="fontSize" title="Tamanho da fonte">
                <option value="1">8px</option>
                <option value="2">10px</option>
                <option value="3" selected>12px</option>
                <option value="4">14px</option>
                <option value="5">16px</option>
                <option value="6">18px</option>
                <option value="7">24px</option>
              </select>
              
              <div class="toolbar-separator"></div>
              
              <button type="button" class="toolbar-btn" data-command="createLink" title="Inserir link">
                üîó Link
              </button>
              <button type="button" class="toolbar-btn" data-command="insertImage" title="Inserir imagem">
                üñºÔ∏è Imagem
              </button>
              <button type="button" class="toolbar-btn" data-command="uploadImage" title="Upload de imagem local">
                üìÅ Upload
              </button>
              <button type="button" class="toolbar-btn" data-command="editSelectedImage" title="Editar imagem selecionada">
                ‚úèÔ∏è Editar
              </button>
              
              <div class="toolbar-separator"></div>
              
              <div class="toolbar-info">
                <span class="toolbar-tip">üí° Dica: Use Ctrl+V para colar imagens</span>
              </div>
            </div>
            <div id="content" class="content-area" contenteditable="true"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="tags" class="form-label">Tags</label>
          <input type="text" id="tags" name="tags" class="form-input" placeholder="tag1, tag2, tag3">
        </div>
        
        <div class="form-group">
          <label for="coverImage" class="form-label">Imagem de Capa</label>
          <input type="file" id="coverImage" name="coverImage" class="form-input" accept="image/*">
        </div>
      </div>
      
      <div class="actions">
        <button type="button" class="btn btn-primary" onclick="savePost()">
          üíæ Salvar Post
        </button>
        <button type="button" class="btn btn-secondary" onclick="goToPostsManager()">
          üìã Gerenciar Posts
        </button>
        <button type="button" class="btn btn-danger" onclick="clearForm()">
          üóëÔ∏è Limpar
        </button>
      </div>
    </form>
    

    
    <!-- Lista de Posts Existentes -->
    <div class="posts-list">
      <h3 class="form-label mb-3">Posts Existentes</h3>
      <div id="existing-posts"></div>
    </div>
  </div>

  <script>
    let currentPost = null;
    
    // Inicializar editor
    document.addEventListener('DOMContentLoaded', function() {
      initializeEditor();
      loadExistingPosts();
    });
    
    function initializeEditor() {
      // Configurar toolbar
      document.querySelectorAll('.toolbar-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const command = this.dataset.command;
          const value = this.dataset.value;
          
                               if (command === 'createLink') {
            const url = prompt('Digite a URL:');
            if (url) {
              const linkText = prompt('Digite o texto do link:', url);
              if (linkText) {
                document.execCommand('insertHTML', false, `<a href="${url}" target="_blank">${linkText}</a>`);
              }
            }
          } else if (command === 'insertImage') {
            const imageUrl = prompt('Digite a URL da imagem:');
            if (imageUrl) {
              const altText = prompt('Digite o texto alternativo da imagem (alt):', '');
              const width = prompt('Digite a largura da imagem (em px, deixe vazio para autom√°tico):', '');
              const height = prompt('Digite a altura da imagem (em px, deixe vazio para autom√°tico):', '');
              
              let style = 'max-width: 100%; margin: 1rem 0;';
              if (width) style += ` width: ${width}px;`;
              if (height) style += ` height: ${height}px;`;
              if (!width && !height) style += ' height: auto;';
              
              const imageHTML = `<img src="${imageUrl}" alt="${altText}" style="${style}" class="editable-image" data-original-width="${width || 'auto'}" data-original-height="${height || 'auto'}">`;
              document.execCommand('insertHTML', false, imageHTML);
            }
          } else if (command === 'uploadImage') {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
              const file = e.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                  const imageData = event.target.result;
                  const altText = prompt('Digite o texto alternativo da imagem (alt):', file.name);
                  
                  // Redimensionar imagem para reduzir tamanho
                  const img = new Image();
                  img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calcular novas dimens√µes (m√°ximo 800px de largura)
                    let newWidth = img.width;
                    let newHeight = img.height;
                    
                    if (newWidth > 800) {
                      newHeight = (newHeight * 800) / newWidth;
                      newWidth = 800;
                    }
                    
                    canvas.width = newWidth;
                    canvas.height = newHeight;
                    
                    // Desenhar imagem redimensionada
                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                    
                    // Converter para base64 com qualidade reduzida
                    const resizedImageData = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Gerar nome √∫nico para a imagem
                    const imageId = 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const imageName = file.name || `upload_${imageId}.jpg`;
                    
                    // Salvar imagem no localStorage
                    saveImageToStorage(imageId, resizedImageData, imageName);
                    
                    // Criar elemento de imagem com refer√™ncia ao ID
                    const imgElement = document.createElement('img');
                    imgElement.src = resizedImageData;
                    imgElement.alt = altText || file.name;
                    imgElement.className = 'editable-image';
                    imgElement.style.cssText = 'max-width: 100%; height: auto; margin: 1rem 0;';
                    imgElement.setAttribute('data-original-width', 'auto');
                    imgElement.setAttribute('data-original-height', 'auto');
                    imgElement.setAttribute('data-image-id', imageId);
                    
                    // Inserir no cursor atual
                    const selection = window.getSelection();
                    if (selection.rangeCount > 0) {
                      const range = selection.getRangeAt(0);
                      range.deleteContents();
                      range.insertNode(imgElement);
                      
                      // Mover cursor ap√≥s a imagem
                      range.setEndAfter(imgElement);
                      selection.removeAllRanges();
                      selection.addRange(range);
                    } else {
                      // Se n√£o h√° sele√ß√£o, inserir no final
                      document.getElementById('content').appendChild(imgElement);
                    }
                    
                    showToast('üñºÔ∏è Imagem enviada e otimizada com sucesso!', 'success');
                  };
                  img.src = imageData;
                };
                reader.readAsDataURL(file);
              }
            };
            input.click();
          } else if (command === 'editSelectedImage') {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
              const range = selection.getRangeAt(0);
              let imgElement = range.commonAncestorContainer;
              
              // Procurar pela imagem mais pr√≥xima
              while (imgElement && imgElement.nodeType !== Node.ELEMENT_NODE) {
                imgElement = imgElement.parentElement;
              }
              
              if (imgElement && imgElement.tagName === 'IMG') {
                editImage(imgElement);
              } else {
                alert('Selecione uma imagem para editar');
              }
            } else {
              alert('Selecione uma imagem para editar');
            }
          } else {
            document.execCommand(command, false, value);
          }
          
          // Atualizar estado dos bot√µes
          updateToolbarState();
        });
      });
      
      // Configurar seletor de tamanho de fonte
      const fontSize = document.getElementById('fontSize');
      if (fontSize) {
        fontSize.addEventListener('change', function() {
          document.execCommand('fontSize', false, this.value);
        });
      }
      
      // Permitir edi√ß√£o de imagens ao clicar
      document.getElementById('content').addEventListener('click', function(e) {
        if (e.target.tagName === 'IMG' && e.target.classList.contains('editable-image')) {
          editImage(e.target);
        }
      });
      
      // Permitir redimensionamento de imagens com duplo clique
      document.getElementById('content').addEventListener('dblclick', function(e) {
        if (e.target.tagName === 'IMG' && e.target.classList.contains('editable-image')) {
          enableImageResize(e.target);
        }
      });
      

      
      // Atalhos de teclado
      document.getElementById('content').addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'b':
              e.preventDefault();
              document.execCommand('bold', false);
              break;
            case 'i':
              e.preventDefault();
              document.execCommand('italic', false);
              break;
            case 'u':
              e.preventDefault();
              document.execCommand('underline', false);
              break;
          }
          updateToolbarState();
        }
        

      });
      
      // Permitir colar imagens (Ctrl+V)
      document.getElementById('content').addEventListener('paste', function(e) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        let imageFound = false;
        
        for (let item of items) {
          if (item.type.indexOf('image') !== -1) {
            e.preventDefault();
            imageFound = true;
            
            const blob = item.getAsFile();
            if (!blob) {
              showToast('‚ùå Erro ao processar imagem do clipboard', 'error');
              return;
            }
            
            // Verificar tamanho do arquivo (m√°ximo 10MB)
            if (blob.size > 10 * 1024 * 1024) {
              showToast('‚ùå Imagem muito grande. M√°ximo 10MB permitido.', 'error');
              return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(event) {
              const imageData = event.target.result;
              
              // Redimensionar imagem para reduzir tamanho
              const img = new Image();
              img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Calcular novas dimens√µes (m√°ximo 800px de largura)
                let newWidth = img.width;
                let newHeight = img.height;
                
                if (newWidth > 800) {
                  newHeight = (newHeight * 800) / newWidth;
                  newWidth = 800;
                }
                
                canvas.width = newWidth;
                canvas.height = newHeight;
                
                // Desenhar imagem redimensionada
                ctx.drawImage(img, 0, 0, newWidth, newHeight);
                
                // Converter para base64 com qualidade reduzida
                const resizedImageData = canvas.toDataURL('image/jpeg', 0.8);
                
                // Gerar nome √∫nico para a imagem
                const imageId = 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const imageName = `clipboard_${imageId}.jpg`;
                
                // Salvar imagem no localStorage
                saveImageToStorage(imageId, resizedImageData, imageName);
                
                // Criar elemento de imagem com refer√™ncia ao ID
                const imgElement = document.createElement('img');
                imgElement.src = resizedImageData;
                imgElement.className = 'editable-image';
                imgElement.style.cssText = 'max-width: 100%; height: auto; margin: 1rem 0;';
                imgElement.setAttribute('data-original-width', 'auto');
                imgElement.setAttribute('data-original-height', 'auto');
                imgElement.setAttribute('alt', 'Imagem colada do clipboard');
                imgElement.setAttribute('data-image-id', imageId);
                
                // Inserir no cursor atual
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                  const range = selection.getRangeAt(0);
                  range.deleteContents();
                  range.insertNode(imgElement);
                  
                  // Mover cursor ap√≥s a imagem
                  range.setStartAfter(imgElement);
                  range.setEndAfter(imgElement);
                  selection.removeAllRanges();
                  selection.addRange(range);
                } else {
                  // Se n√£o h√° sele√ß√£o, inserir no final
                  document.getElementById('content').appendChild(imgElement);
                }
                
                // Focar na imagem inserida
                imgElement.focus();
                
                // Mostrar mensagem de sucesso
                showToast('üñºÔ∏è Imagem colada e otimizada com sucesso!', 'success');
              };
              img.src = imageData;
            };
            
            reader.onerror = function() {
              showToast('‚ùå Erro ao ler imagem do clipboard', 'error');
            };
            
            reader.readAsDataURL(blob);
            break;
          }
        }
        
        // Se n√£o encontrou imagem, verificar se √© uma URL de imagem
        if (!imageFound) {
          const text = e.clipboardData.getData('text');
          if (text && isImageUrl(text)) {
            e.preventDefault();
            
            // Perguntar se quer inserir como imagem
            if (confirm('URL de imagem detectada. Deseja inserir como imagem?\n\n' + text)) {
              const img = document.createElement('img');
              img.src = text;
              img.className = 'editable-image';
              img.style.cssText = 'max-width: 100%; height: auto; margin: 1rem 0;';
              img.setAttribute('data-original-width', 'auto');
              img.setAttribute('data-original-height', 'auto');
              img.setAttribute('alt', 'Imagem de URL');
              
              // Inserir no cursor atual
              const selection = window.getSelection();
              if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(img);
                
                // Mover cursor ap√≥s a imagem
                range.setStartAfter(img);
                range.setEndAfter(img);
                selection.removeAllRanges();
                selection.addRange(range);
              } else {
                // Se n√£o h√° sele√ß√£o, inserir no final
                document.getElementById('content').appendChild(img);
              }
              
              showToast('üñºÔ∏è Imagem de URL inserida com sucesso!', 'success');
            }
          }
          // Permitir colar texto normalmente
          return;
        }
      });
      
      // Auto-save
      setInterval(autoSave, 30000); // Salvar a cada 30 segundos
    }
    
    function editImage(imgElement) {
      const currentWidth = imgElement.style.width || 'auto';
      const currentHeight = imgElement.style.height || 'auto';
      
      const newWidth = prompt('Digite a nova largura da imagem (em px, deixe vazio para autom√°tico):', currentWidth === 'auto' ? '' : currentWidth.replace('px', ''));
      const newHeight = prompt('Digite a nova altura da imagem (em px, deixe vazio para autom√°tico):', currentHeight === 'auto' ? '' : currentHeight.replace('px', ''));
      
      if (newWidth !== null && newHeight !== null) {
        let style = 'max-width: 100%; margin: 1rem 0;';
        if (newWidth) style += ` width: ${newWidth}px;`;
        if (newHeight) style += ` height: ${newHeight}px;`;
        if (!newWidth && !newHeight) style += ' height: auto;';
        
        imgElement.style.cssText = style;
        imgElement.setAttribute('data-original-width', newWidth || 'auto');
        imgElement.setAttribute('data-original-height', newHeight || 'auto');
        
        // Adicionar indicador visual de que foi editada
        imgElement.classList.add('image-edited');
      }
    }
    
    function enableImageResize(imgElement) {
      // Remover redimensionamento anterior se existir
      if (imgElement.classList.contains('resizing')) {
        disableImageResize(imgElement);
        return;
      }
      
      imgElement.classList.add('resizing');
      
      // Criar handles de redimensionamento
      const handles = createResizeHandles(imgElement);
      imgElement.parentNode.insertBefore(handles, imgElement.nextSibling);
      
      // Adicionar indicador visual
      imgElement.style.border = '2px solid #052b18';
      imgElement.style.cursor = 'move';
      
      // Adicionar instru√ß√µes
      const instructions = document.createElement('div');
      instructions.className = 'resize-instructions';
      instructions.innerHTML = 'üñ±Ô∏è Arraste os cantos para redimensionar | Clique duplo para sair';
      instructions.style.cssText = 'position: absolute; top: -40px; left: 50%; transform: translateX(-50%); background: #052b18; color: white; padding: 8px 12px; border-radius: 6px; font-size: 12px; white-space: nowrap; z-index: 1000;';
      imgElement.parentNode.insertBefore(instructions, imgElement.nextSibling);
    }
    
    function disableImageResize(imgElement) {
      imgElement.classList.remove('resizing');
      imgElement.style.border = '';
      imgElement.style.cursor = '';
      
      // Remover handles e instru√ß√µes
      const handles = imgElement.parentNode.querySelector('.resize-handles');
      const instructions = imgElement.parentNode.querySelector('.resize-instructions');
      if (handles) handles.remove();
      if (instructions) instructions.remove();
      
      // Salvar dimens√µes finais
      const finalWidth = imgElement.style.width;
      const finalHeight = imgElement.style.height;
      if (finalWidth || finalHeight) {
        imgElement.classList.add('image-edited');
        imgElement.setAttribute('data-original-width', finalWidth || 'auto');
        imgElement.setAttribute('data-original-height', finalHeight || 'auto');
      }
    }
    
    function createResizeHandles(imgElement) {
      const handles = document.createElement('div');
      handles.className = 'resize-handles';
      handles.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999;';
      
      const positions = ['nw', 'ne', 'sw', 'se'];
      positions.forEach(pos => {
        const handle = document.createElement('div');
        handle.className = `resize-handle resize-${pos}`;
        handle.style.cssText = `
          position: absolute;
          width: 12px;
          height: 12px;
          background: #052b18;
          border: 2px solid white;
          border-radius: 50%;
          pointer-events: all;
          cursor: ${pos.includes('n') ? 'n' : 's'}-${pos.includes('w') ? 'w' : 'e'}-resize;
        `;
        
        // Posicionar handles
        if (pos.includes('n')) handle.style.top = '-6px';
        if (pos.includes('s')) handle.style.bottom = '-6px';
        if (pos.includes('w')) handle.style.left = '-6px';
        if (pos.includes('e')) handle.style.right = '-6px';
        
        // Adicionar funcionalidade de redimensionamento
        handle.addEventListener('mousedown', (e) => startResize(e, imgElement, pos));
        
        handles.appendChild(handle);
      });
      
      return handles;
    }
    
    function startResize(e, imgElement, handle) {
      e.preventDefault();
      e.stopPropagation();
      
      const startX = e.clientX;
      const startY = e.clientY;
      const startWidth = imgElement.offsetWidth;
      const startHeight = imgElement.offsetHeight;
      
      function onMouseMove(e) {
        const deltaX = e.clientX - startX;
        const deltaY = e.clientY - startY;
        
        let newWidth = startWidth;
        let newHeight = startHeight;
        
        if (handle.includes('e')) newWidth = startWidth + deltaX;
        if (handle.includes('w')) newWidth = startWidth - deltaX;
        if (handle.includes('s')) newHeight = startHeight + deltaY;
        if (handle.includes('n')) newHeight = startHeight - deltaY;
        
        // Manter propor√ß√£o m√≠nima
        newWidth = Math.max(50, newWidth);
        newHeight = Math.max(50, newHeight);
        
        imgElement.style.width = newWidth + 'px';
        imgElement.style.height = newHeight + 'px';
      }
      
      function onMouseUp() {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }
      
      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    }
    

    
    function isImageUrl(url) {
      try {
        const urlObj = new URL(url);
        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.svg'];
        const pathname = urlObj.pathname.toLowerCase();
        
        // Verificar extens√£o do arquivo
        const hasImageExtension = imageExtensions.some(ext => pathname.endsWith(ext));
        
        // Verificar se cont√©m palavras-chave de imagem
        const hasImageKeywords = url.includes('image') || url.includes('img') || url.includes('photo') || url.includes('pic');
        
        return hasImageExtension || hasImageKeywords;
      } catch (e) {
        // Se n√£o √© uma URL v√°lida, verificar se parece ser uma URL de imagem
        const imagePatterns = /\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?|$)/i;
        return imagePatterns.test(url);
      }
    }
    
    function showToast(message, type = 'info') {
      // Remover toast anterior se existir
      const existingToast = document.querySelector('.toast-message');
      if (existingToast) {
        existingToast.remove();
      }
      
      // Criar novo toast
      const toast = document.createElement('div');
      toast.className = `toast-message toast-${type}`;
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#052b18' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 10000;
        font-size: 14px;
        font-weight: 500;
        max-width: 300px;
        word-wrap: break-word;
        animation: slideIn 0.3s ease;
      `;
      
      // Adicionar anima√ß√£o CSS
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        
        @keyframes slideOut {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(100%);
            opacity: 0;
          }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(toast);
      
      // Auto-remover ap√≥s 4 segundos
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.remove();
          }
        }, 300);
      }, 4000);
      
      // Permitir fechar clicando
      toast.addEventListener('click', () => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.remove();
          }
        }, 300);
      });
    }
    
    function updateToolbarState() {
      document.querySelectorAll('.toolbar-btn').forEach(btn => {
        const command = btn.dataset.command;
        btn.classList.toggle('active', document.queryCommandState(command));
      });
    }
    

    
    // Fun√ß√£o para limpar HTML indevido (vers√£o melhorada)
    function cleanHtmlContent(html) {
      if (!html) return '';
      
      // Se o conte√∫do j√° parece ser Markdown (n√£o tem tags HTML), retornar como est√°
      if (!/<[^>]*>/.test(html)) {
        return html.trim();
      }
      
      // Processar o HTML de forma mais inteligente
      let cleanContent = html;
      
      // 1. Primeiro, normalizar quebras de linha
      cleanContent = cleanContent
        .replace(/<br\s*\/?>/gi, '\n')
        .replace(/<\/p>/gi, '\n')
        .replace(/<\/div>/gi, '\n');
      
      // 2. Converter tags de formata√ß√£o para Markdown (uma vez s√≥)
      cleanContent = cleanContent
        // Converter tags b/strong para ** (apenas se n√£o tiver estilos problem√°ticos)
        .replace(/<b[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/b>/gi, '$1')
        .replace(/<strong[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/strong>/gi, '$1')
        .replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**')
        .replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**')
        
        // Converter tags i/em para * (apenas se n√£o tiver estilos problem√°ticos)
        .replace(/<i[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/i>/gi, '$1')
        .replace(/<em[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/em>/gi, '$1')
        .replace(/<i[^>]*>(.*?)<\/i>/gi, '*$1*')
        .replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*')
        
        // Converter tags u para __ (apenas se n√£o tiver estilos problem√°ticos)
        .replace(/<u[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/u>/gi, '$1')
        .replace(/<u[^>]*>(.*?)<\/u>/gi, '__$1__');
      
      // 3. Remover tags de fonte problem√°ticas (completamente)
      cleanContent = cleanContent
        .replace(/<font[^>]*size\s*=\s*["']?\d+["']?[^>]*>(.*?)<\/font>/gi, '$1')
        .replace(/<font[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/font>/gi, '$1')
        .replace(/<font[^>]*>(.*?)<\/font>/gi, '$1');
      
      // 4. Remover tags span e div com estilos inline
      cleanContent = cleanContent
        .replace(/<span[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/span>/gi, '$1')
        .replace(/<span[^>]*>(.*?)<\/span>/gi, '$1')
        .replace(/<div[^>]*style\s*=\s*["'][^"']*["'][^>]*>(.*?)<\/div>/gi, '\n$1\n')
        .replace(/<div[^>]*>(.*?)<\/div>/gi, '\n$1\n');
      
      // 5. Converter cabe√ßalhos para Markdown
      cleanContent = cleanContent
        .replace(/<h1[^>]*>(.*?)<\/h1>/gi, '\n# $1\n')
        .replace(/<h2[^>]*>(.*?)<\/h2>/gi, '\n## $1\n')
        .replace(/<h3[^>]*>(.*?)<\/h3>/gi, '\n### $1\n')
        .replace(/<h4[^>]*>(.*?)<\/h4>/gi, '\n#### $1\n')
        .replace(/<h5[^>]*>(.*?)<\/h5>/gi, '\n##### $1\n')
        .replace(/<h6[^>]*>(.*?)<\/h6>/gi, '\n###### $1\n');
      
      // 6. Converter par√°grafos
      cleanContent = cleanContent
        .replace(/<p[^>]*>(.*?)<\/p>/gi, '\n$1\n');
      
      // 7. Converter listas
      cleanContent = cleanContent
        .replace(/<ul[^>]*>(.*?)<\/ul>/gi, '\n$1\n')
        .replace(/<ol[^>]*>(.*?)<\/ol>/gi, '\n$1\n')
        .replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1');
      
      // 8. Converter links
      cleanContent = cleanContent
        .replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)');
      
      // 9. Converter cita√ß√µes
      cleanContent = cleanContent
        .replace(/<blockquote[^>]*>(.*?)<\/blockquote>/gi, '\n> $1\n');
      
      // 10. Converter c√≥digo
      cleanContent = cleanContent
        .replace(/<code[^>]*>(.*?)<\/code>/gi, '`$1`');
      
      // 11. Converter imagens para Markdown (com tratamento especial para imagens com ID)
      cleanContent = cleanContent
        .replace(/<img[^>]*data-image-id="([^"]*)"[^>]*alt="([^"]*)"[^>]*>/gi, (match, imageId, alt) => {
          return `![${alt}](imagem:${imageId})`;
        })
        .replace(/<img[^>]*alt="([^"]*)"[^>]*data-image-id="([^"]*)"[^>]*>/gi, (match, alt, imageId) => {
          return `![${alt}](imagem:${imageId})`;
        })
        .replace(/<img[^>]*data-image-id="([^"]*)"[^>]*>/gi, (match, imageId) => {
          return `![](${imageId})`;
        })
        .replace(/<img[^>]*src="([^"]*)"[^>]*alt="([^"]*)"[^>]*>/gi, '![$2]($1)')
        .replace(/<img[^>]*alt="([^"]*)"[^>]*src="([^"]*)"[^>]*>/gi, '![$1]($2)')
        .replace(/<img[^>]*src="([^"]*)"[^>]*>/gi, '![]($1)');
      
      // 12. Remover todas as outras tags HTML restantes (exceto imagens j√° convertidas)
      cleanContent = cleanContent.replace(/<[^>]*>/g, '');
      
      // 13. Limpar formata√ß√£o Markdown duplicada (melhorado)
      cleanContent = cleanContent
        // Remover asteriscos duplicados
        .replace(/\*\*\s*\*\*/g, '**')
        .replace(/\*\s\*/g, ' ')
        // Remover underscores duplicados
        .replace(/__\s*__/g, '__')
        .replace(/_\s_/g, ' ')
        // Limpar espa√ßos antes e depois de formata√ß√£o
        .replace(/\s+\*\*/g, ' **')
        .replace(/\*\*\s+/g, '** ')
        .replace(/\s+\*/g, ' *')
        .replace(/\*\s+/g, '* ')
        .replace(/\s+__/g, ' __')
        .replace(/__\s+/g, '__ ')
        .replace(/\s+_/g, ' _')
        .replace(/_\s+/g, '_ ')
        // Limpar formata√ß√£o duplicada espec√≠fica
        .replace(/\*\*([^*]+)\*\*\*/g, '**$1**')
        .replace(/\*([^*]+)\*\*/g, '*$1*')
        .replace(/__([^_]+)___/g, '__$1__')
        .replace(/_([^_]+)_/g, '_$1_');
      
      // 14. Limpar quebras de linha e espa√ßos
      cleanContent = cleanContent
        .replace(/\n\s*\n\s*\n/g, '\n\n')
        .replace(/\n\s*\n/g, '\n\n')
        .trim();
      
      return cleanContent;
    }
    
    function savePost() {
      const formData = new FormData(document.getElementById('blog-form'));
      const content = document.getElementById('content').innerHTML;
      
      if (!formData.get('title') || !formData.get('author') || !formData.get('category') || 
          !formData.get('excerpt') || !content.trim()) {
        showStatus('Preencha todos os campos obrigat√≥rios', 'error');
        return;
      }
      
      // Limpar o conte√∫do antes de salvar
      const cleanContent = cleanHtmlContent(content);
      
      // Debug: mostrar o conte√∫do limpo no console
      console.log('Conte√∫do original:', content);
      console.log('Conte√∫do limpo:', cleanContent);
      
      const post = {
        id: currentPost ? currentPost.id : Date.now().toString(),
        title: formData.get('title'),
        author: formData.get('author'),
        category: formData.get('category'),
        excerpt: formData.get('excerpt'),
        content: cleanContent, // Usar conte√∫do limpo
        tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
        date: new Date().toISOString(),
        slug: generateSlug(formData.get('title')),
        coverImage: formData.get('coverImage') ? formData.get('coverImage').name : null,
        readTime: calculateReadTime(cleanContent)
      };
      
      // Salvar no localStorage
      savePostToStorage(post);
      
      // Salvar arquivo Markdown
      savePostToFile(post);
      
      showStatus('Post salvo com sucesso! Redirecionando para gerenciamento de posts em 2 segundos...', 'success');
      currentPost = post;
      
      // Atualizar lista de posts existentes
      loadExistingPosts();
      
      // Limpar formul√°rio ap√≥s salvar
      clearForm();
      
      // Mostrar contagem regressiva
      let countdown = 2;
      const countdownInterval = setInterval(() => {
        countdown--;
        if (countdown > 0) {
          showStatus(`Post salvo com sucesso! Redirecionando em ${countdown} segundo${countdown > 1 ? 's' : ''}...`, 'success');
        } else {
          clearInterval(countdownInterval);
          showStatus('Redirecionando...', 'success');
          // Redirecionar para a √°rea de gerenciamento de posts
          setTimeout(() => {
            try {
              window.location.href = './posts-manager.html';
            } catch (error) {
              console.error('Erro no redirecionamento:', error);
              // Fallback: tentar caminho absoluto
              window.location.href = '/admin/posts-manager.html';
            }
          }, 500);
        }
      }, 1000);
    }
    
    function savePostToStorage(post) {
      const posts = JSON.parse(localStorage.getItem('nodalEnergyPosts') || '[]');
      const existingIndex = posts.findIndex(p => p.id === post.id);
      
      if (existingIndex >= 0) {
        posts[existingIndex] = post;
      } else {
        posts.push(post);
      }
      
      localStorage.setItem('nodalEnergyPosts', JSON.stringify(posts));
    }
    
    function savePostToFile(post) {
      // Converter para Markdown
      const markdown = convertToMarkdown(post);
      
      // Criar blob e download
      const blob = new Blob([markdown], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${post.slug}.md`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    function convertToMarkdown(post) {
      let markdown = `---\n`;
      markdown += `title: "${post.title}"\n`;
      markdown += `author: "${post.author}"\n`;
      markdown += `date: "${post.date}"\n`;
      markdown += `category: "${post.category}"\n`;
      markdown += `excerpt: "${post.excerpt}"\n`;
      if (post.tags.length > 0) {
        markdown += `tags: [${post.tags.map(t => `"${t}"`).join(', ')}]\n`;
      }
      if (post.coverImage) {
        markdown += `coverImage: "${post.coverImage}"\n`;
      }
      markdown += `---\n\n`;
      markdown += `# ${post.title}\n\n`;
      markdown += `**Autor:** ${post.author} | **Data:** ${new Date(post.date).toLocaleDateString('pt-BR')} | **Categoria:** ${post.category}\n\n`;
      markdown += `${post.excerpt}\n\n`;
      markdown += `---\n\n`;
      
      // Se o conte√∫do j√° √© Markdown, usar diretamente
      if (!/<[^>]*>/.test(post.content)) {
        markdown += post.content;
      } else {
        // Apenas se ainda houver HTML, converter uma vez
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = post.content;
        
        // Processar elementos HTML de forma mais robusta
        let content = tempDiv.innerHTML
          // Remover tags de cabe√ßalho
          .replace(/<h1[^>]*>(.*?)<\/h1>/gi, '\n# $1\n')
          .replace(/<h2[^>]*>(.*?)<\/h2>/gi, '\n## $1\n')
          .replace(/<h3[^>]*>(.*?)<\/h3>/gi, '\n### $1\n')
          // Remover tags de par√°grafo
          .replace(/<p[^>]*>(.*?)<\/p>/gi, '\n$1\n')
          // Remover quebras de linha
          .replace(/<br\s*\/?>/gi, '\n')
          // Converter formata√ß√£o de texto
          .replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**')
          .replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*')
          .replace(/<u[^>]*>(.*?)<\/u>/gi, '__$1__')
          .replace(/<code[^>]*>(.*?)<\/code>/gi, '`$1`')
          // Converter cita√ß√µes
          .replace(/<blockquote[^>]*>(.*?)<\/blockquote>/gi, '\n> $1\n')
          // Converter listas
          .replace(/<ul[^>]*>(.*?)<\/ul>/gi, '\n$1\n')
          .replace(/<ol[^>]*>(.*?)<\/ol>/gi, '\n$1\n')
          .replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1')
          // Converter links
          .replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)')
                  // Converter imagens para Markdown (com tratamento especial para imagens com ID)
        .replace(/<img[^>]*data-image-id="([^"]*)"[^>]*alt="([^"]*)"[^>]*>/gi, '\n![$2](imagem:$1)\n')
        .replace(/<img[^>]*alt="([^"]*)"[^>]*data-image-id="([^"]*)"[^>]*>/gi, '\n![$1](imagem:$2)\n')
        .replace(/<img[^>]*data-image-id="([^"]*)"[^>]*>/gi, '\n![]($1)\n')
        .replace(/<img[^>]*src="([^"]*)"[^>]*alt="([^"]*)"[^>]*>/gi, '\n![$2]($1)\n')
        .replace(/<img[^>]*alt="([^"]*)"[^>]*src="([^"]*)"[^>]*>/gi, '\n![$1]($2)\n')
        .replace(/<img[^>]*src="([^"]*)"[^>]*>/gi, '\n![]($1)\n')
          // Limpar tags HTML restantes
          .replace(/<[^>]*>/g, '')
          // Limpar espa√ßos em branco extras
          .replace(/\n\s*\n\s*\n/g, '\n\n')
          .trim();
        
        markdown += content;
      }
      
      return markdown;
    }
    
    function generateSlug(title) {
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .trim();
    }
    
    function calculateReadTime(content) {
      const wordsPerMinute = 200;
      const words = content.split(/\s+/).length;
      const minutes = Math.ceil(words / wordsPerMinute);
      return `${minutes} min`;
    }
    
    function loadExistingPosts() {
      const posts = JSON.parse(localStorage.getItem('nodalEnergyPosts') || '[]');
      const container = document.getElementById('existing-posts');
      
      if (posts.length === 0) {
        container.innerHTML = '<p class="text-gray-500">Nenhum post encontrado</p>';
        return;
      }
      
      container.innerHTML = posts.map(post => `
        <div class="post-item" onclick="loadPost('${post.id}')">
          <div class="post-title">${post.title}</div>
          <div class="post-meta">
            ${post.author} ‚Ä¢ ${post.category} ‚Ä¢ ${new Date(post.date).toLocaleDateString('pt-BR')}
          </div>
        </div>
      `).join('');
    }
    
    function loadPost(postId) {
      const posts = JSON.parse(localStorage.getItem('nodalEnergyPosts') || '[]');
      const post = posts.find(p => p.id === postId);
      
      if (post) {
        currentPost = post;
        document.getElementById('title').value = post.title;
        document.getElementById('author').value = post.author;
        document.getElementById('category').value = post.category;
        document.getElementById('excerpt').value = post.excerpt;
        // Converter Markdown de volta para HTML edit√°vel
        const editableContent = markdownToHtml(post.content);
        document.getElementById('content').innerHTML = editableContent;
        document.getElementById('tags').value = post.tags ? post.tags.join(', ') : '';
        
        showStatus(`Post "${post.title}" carregado para edi√ß√£o`, 'info');
        
        // Scroll para o topo do formul√°rio
        document.getElementById('blog-form').scrollIntoView({ behavior: 'smooth' });
      }
    }
    
    // Fun√ß√£o para converter Markdown de volta para HTML edit√°vel
    function markdownToHtml(markdown) {
      if (!markdown) return '';
      
      let html = markdown;
      
      // Converter cabe√ßalhos
      html = html
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^#### (.*$)/gm, '<h4>$1</h4>')
        .replace(/^##### (.*$)/gm, '<h5>$1</h5>')
        .replace(/^###### (.*$)/gm, '<h6>$1</h6>');
      
      // Converter formata√ß√£o de texto
      html = html
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/__(.*?)__/g, '<u>$1</u>')
        .replace(/`(.*?)`/g, '<code>$1</code>');
      
      // Converter cita√ß√µes
      html = html.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
      
      // Converter listas
      html = html
        .replace(/^- (.*$)/gm, '<li>$1</li>')
        .replace(/^(\d+)\. (.*$)/gm, '<li>$2</li>');
      
      // Envolver listas em ul/ol
      html = html
        .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
        .replace(/<\/ul>\s*<ul>/g, '');
      
      // Converter links
      html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>');
      
      // Converter imagens (com tratamento especial para imagens com ID)
      html = html
        .replace(/!\[([^\]]*)\]\(imagem:([^)]+)\)/g, (match, alt, imageId) => {
          const imageUrl = getImageUrl(imageId);
          if (imageUrl) {
            return `<img src="${imageUrl}" alt="${alt}" class="editable-image" style="max-width: 100%; height: auto; margin: 1rem 0;">`;
          }
          return `<div style="background: #f3f4f6; padding: 1rem; text-align: center; border-radius: 8px; border: 2px dashed #d1d5db;">
            <p style="color: #6b7280; margin: 0;">üñºÔ∏è Imagem n√£o encontrada</p>
            <p style="color: #9ca3af; font-size: 0.875rem; margin: 0.5rem 0 0 0;">Alt: ${alt || 'Sem descri√ß√£o'}</p>
          </div>`;
        })
        .replace(/!\[\]\(imagem:([^)]+)\)/g, (match, imageId) => {
          const imageUrl = getImageUrl(imageId);
          if (imageUrl) {
            return `<img src="${imageUrl}" alt="" class="editable-image" style="max-width: 100%; height: auto; margin: 1rem 0;">`;
          }
          return `<div style="background: #f3f4f6; padding: 1rem; text-align: center; border-radius: 8px; border: 2px dashed #d1d5db;">
            <p style="color: #6b7280; margin: 0;">üñºÔ∏è Imagem n√£o encontrada</p>
          </div>`;
        })
        .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1" class="editable-image" style="max-width: 100%; height: auto; margin: 1rem 0;">')
        .replace(/!\[\]\(([^)]+)\)/g, '<img src="$1" alt="" class="editable-image" style="max-width: 100%; height: auto; margin: 1rem 0;">');
      
      // Converter par√°grafos (envolver texto n√£o processado em <p>)
      html = html
        .replace(/(?<!<[^>]*>)([^<>\n]+)(?!<[^>]*>)/g, '<p>$1</p>')
        .replace(/<p><\/p>/g, '')
        .replace(/<p>(<h[1-6]>.*<\/h[1-6]>)<\/p>/g, '$1')
        .replace(/<p>(<blockquote>.*<\/blockquote>)<\/p>/g, '$1')
        .replace(/<p>(<ul>.*<\/ul>)<\/p>/g, '$1')
        .replace(/<p>(<img[^>]*>)<\/p>/g, '$1');
      
      // Limpar HTML extra
      html = html
        .replace(/<p><p>/g, '<p>')
        .replace(/<\/p><\/p>/g, '</p>')
        .replace(/\n/g, '<br>');
      
      return html;
    }
    
    function clearForm() {
      if (confirm('Tem certeza que deseja limpar o formul√°rio?')) {
        document.getElementById('blog-form').reset();
        document.getElementById('content').innerHTML = '';
        currentPost = null;
        showStatus('Formul√°rio limpo', 'info');
      }
    }
    
    function goToPostsManager() {
      try {
        window.location.href = './posts-manager.html';
      } catch (error) {
        console.error('Erro no redirecionamento:', error);
        // Fallback: tentar caminho absoluto
        window.location.href = '/admin/posts-manager.html';
      }
    }
    
    function saveImageToStorage(imageId, imageData, imageName) {
      try {
        const images = JSON.parse(localStorage.getItem('nodalEnergyImages') || '{}');
        images[imageId] = {
          data: imageData,
          name: imageName,
          timestamp: Date.now()
        };
        localStorage.setItem('nodalEnergyImages', JSON.stringify(images));
        console.log(`Imagem salva: ${imageId} - ${imageName}`);
      } catch (error) {
        console.error('Erro ao salvar imagem:', error);
      }
    }
    
    function getImageUrl(imageId) {
      try {
        const images = JSON.parse(localStorage.getItem('nodalEnergyImages') || '{}');
        return images[imageId] ? images[imageId].data : null;
      } catch (error) {
        console.error('Erro ao buscar imagem:', error);
        return null;
      }
    }
    

    
    function autoSave() {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').innerHTML;
      
      if (title && content.trim()) {
        const draft = {
          title,
          content,
          timestamp: Date.now()
        };
        localStorage.setItem('nodalEnergyDraft', JSON.stringify(draft));
      }
    }
    
    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status-message');
      statusDiv.textContent = message;
      statusDiv.className = `status-message status-${type}`;
      statusDiv.style.display = 'block';
      
      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 5000);
    }
  </script>
</body>
</html>

